# name: Release Python (PyPI)

# on:
#   push:
#     tags:
#       - 'v*'
#   workflow_dispatch:
#     inputs:
#       publish:
#         description: 'Publish to PyPI (true/false)'
#         required: true
#         default: 'false'

# permissions:
#   contents: read

# jobs:
#   # ============================================================================
#   # Build wheels for multiple platforms
#   # ============================================================================
#   build-wheels:
#     name: Build wheels on ${{ matrix.os }}
#     runs-on: ${{ matrix.os }}
#     strategy:
#       fail-fast: false
#       matrix:
#         include:
#           - os: ubuntu-latest
#             target: x86_64-unknown-linux-gnu
#           - os: ubuntu-latest
#             target: aarch64-unknown-linux-gnu
#           - os: macos-latest
#             target: x86_64-apple-darwin
#           - os: macos-latest
#             target: aarch64-apple-darwin
#           - os: windows-latest
#             target: x86_64-pc-windows-msvc

#     steps:
#       - uses: actions/checkout@v4

#       - name: Install Rust
#         uses: dtolnay/rust-toolchain@stable
#         with:
#           targets: ${{ matrix.target }}

#       - name: Set up Python
#         uses: actions/setup-python@v5
#         with:
#           python-version: '3.11'

#       - name: Install maturin
#         run: pip install maturin

#       - name: Install cross-compilation tools (Linux aarch64)
#         if: matrix.target == 'aarch64-unknown-linux-gnu'
#         run: |
#           sudo apt-get update
#           sudo apt-get install -y gcc-aarch64-linux-gnu

#       - name: Build wheel
#         run: |
#           cd crates/surgedb-bindings
#           maturin build --release --target ${{ matrix.target }} --out dist
#         env:
#           CARGO_TARGET_AARCH64_UNKNOWN_LINUX_GNU_LINKER: aarch64-linux-gnu-gcc

#       - name: Upload wheel
#         uses: actions/upload-artifact@v4
#         with:
#           name: wheels-${{ matrix.target }}
#           path: crates/surgedb-bindings/dist/*.whl

#   # ============================================================================
#   # Build source distribution
#   # ============================================================================
#   build-sdist:
#     name: Build source distribution
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4

#       - name: Set up Python
#         uses: actions/setup-python@v5
#         with:
#           python-version: '3.11'

#       - name: Install maturin
#         run: pip install maturin

#       - name: Build sdist
#         run: |
#           cd crates/surgedb-bindings
#           maturin sdist --out dist

#       - name: Upload sdist
#         uses: actions/upload-artifact@v4
#         with:
#           name: sdist
#           path: crates/surgedb-bindings/dist/*.tar.gz

#   # ============================================================================
#   # Publish to PyPI
#   # ============================================================================
#   publish:
#     name: Publish to PyPI
#     needs: [build-wheels, build-sdist]
#     runs-on: ubuntu-latest
#     if: startsWith(github.ref, 'refs/tags/v') || github.event.inputs.publish == 'true'
#     environment:
#       name: pypi
#       url: https://pypi.org/project/surgedb/
#     permissions:
#       id-token: write

#     steps:
#       - name: Download all artifacts
#         uses: actions/download-artifact@v4
#         with:
#           path: dist
#           merge-multiple: true

#       - name: Publish to PyPI
#         uses: pypa/gh-action-pypi-publish@release/v1
#         with:
#           packages-dir: dist/
